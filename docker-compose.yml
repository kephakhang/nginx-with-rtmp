services:
  vod-server:
    image: nginx-rtmp:1.0.0
    ports:
      - 8000:80
      - 1935:1935
    volumes:
      - ./nginx/conf:/usr/local/nginx/conf
      - ./nginx/logs:/usr/local/nginx/logs
      - ./nginx/client_body_temp:/usr/local/nginx/client_body_temp
      - ./nginx/proxy_temp:/usr/local/nginx/proxy_temp
      - ./nginx/scgi_temp:/usr/local/nginx/scgi_temp
      - ./nginx/uwsgi_temp:/usr/local/nginx/uwsgi_temp
      - ./nginx/html/stream:/usr/local/nginx/html/stream
    deploy:
      mode: replicated
      replicas: 1
      update_config:
        parallelism: 3
        order: start-first
        delay: 10s
        failure_action: rollback
    healthcheck:
      test: ["CMD", "curl", "-f", "http://127.0.0.1/index.html"]
      #test: ["CMD-SHELL", "exit 0"]
      interval: 60s
      timeout: 5s
      retries: 3
      start_period: 60s
volumes:
  etc-nginx:
  logs-nginx:
  stream-nginx:
